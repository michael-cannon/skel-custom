#!/bin/bash

# Pull and compress WordPress plugins for release or beta testing
#
# @author Michael Cannon <mc@aihr.us>

source ~/.skel/bin/custom/wpinit ${@}
echo

if [[ -n ${2} ]]
then
	VERSION=${2}
fi

for PLUGIN in ${PLUGINS}
do
	cd ${DIR_DOWNLOADS}

	if [[ -d ${PLUGIN} ]]
	then
		rm -rf ${PLUGIN}
	fi

	if [[ "testimonials-widget-premium" == ${PLUGIN} ]]
	then
		echo Prepare Testimonials Widget Premium
		git clone git@github.com:michael-cannon/testimonials-widget-premium.git ${PLUGIN}
	elif [[ "custom-bulk-quick-edit" == ${PLUGIN} ]]
	then
		echo Prepare Custom Bulk/Quick Edit
		git clone git@github.com:michael-cannon/custom-bulk-quick-edit.git ${PLUGIN}
	else
		echo Prepare ${PLUGIN} 
		# svn co http://plugins.svn.wordpress.org/${PLUGIN}/trunk ${PLUGIN}
		git clone git@github.com:michael-cannon/testimonials-widget.git ${PLUGIN}
	fi

	cd ${PLUGIN}
	find . -type d \( -name ".git" -o -name ".svn" \) -exec rm -rf {} \;

	cd ${DIR_DOWNLOADS}

	FILE_ZIP="${PLUGIN}.zip"
	if [[ -e ${FILE_ZIP} ]]
	then
		rm -f ${FILE_ZIP}
	fi

	zip -r ${FILE_ZIP} ${PLUGIN}

	if [[ -n ${VERSION} ]]
	then
		FILE_ZIP="${PLUGIN}-${VERSION}.zip"
		if [[ -e ${FILE_ZIP} ]]
		then
			rm -f ${FILE_ZIP}
		fi

		zip -r ${FILE_ZIP} ${PLUGIN}
	fi

	cd ${PLUGIN}
	find . -maxdepth 1 -type f -name "screenshot-*" -exec rm -f {} \;

	cd ${DIR_DOWNLOADS}

	FILE_ZIP="${PLUGIN}-no-screenshots.zip"
	if [[ -e ${FILE_ZIP} ]]
	then
		rm -f ${FILE_ZIP}
	fi

	zip -r ${FILE_ZIP} ${PLUGIN}

	if [[ -n ${VERSION} ]]
	then
		FILE_ZIP="${PLUGIN}-${VERSION}-no-screenshots.zip"
		if [[ -e ${FILE_ZIP} ]]
		then
			rm -f ${FILE_ZIP}
		fi

		zip -r ${FILE_ZIP} ${PLUGIN}
	fi

	rm -rf ${PLUGIN}

	echo
done